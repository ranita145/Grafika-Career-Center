<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lowongan Magang ‚Äî Grafika Career Center (Guru)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=PT+Sans:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --black:#000000;
      --white:#ffffff;
      --cyan:#00B4D8;
      --blue600:#0077B6;
      --blue900:#023E8A;
      --radius:12px;
      --shadow:0 6px 18px rgba(2,46,91,0.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'PT Sans',Arial;background:var(--white);color:var(--black)}
    a{text-decoration:none;color:inherit}

    /* HEADER */
    .header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;
      background:linear-gradient(90deg,var(--blue900),var(--blue600));color:var(--white);position:sticky;top:0;z-index:50}
    .header-left{display:flex;align-items:center;gap:12px}
    .logo{font-family:'Bebas Neue';font-size:26px}
    .search{background:#fff;padding:8px 12px;border-radius:999px;display:flex;align-items:center;
      min-width:300px;box-shadow:var(--shadow)}
    .search input{border:0;outline:0;background:transparent;font-size:14px}

    .header-right{display:flex;align-items:center;gap:12px}
    .icon-btn{background:transparent;border:0;color:#fff;font-size:20px;padding:8px;cursor:pointer;border-radius:8px}
    .badge{background:var(--cyan);color:#000;font-weight:700;padding:2px 6px;border-radius:999px;font-size:12px;
      position:absolute;top:2px;right:2px}

    /* menu */
    .menu{position:relative}
    .menu-box{display:none;position:absolute;right:0;top:44px;background:#fff;color:#000;border-radius:10px;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);min-width:260px;padding:8px}
    .menu-box button{background:transparent;border:0;width:100%;text-align:left;padding:10px;border-radius:8px;cursor:pointer}
    .menu-box hr{border:0;border-top:1px solid rgba(0,0,0,0.08);margin:6px 0}

    /* content */
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    h1{font-family:'Bebas Neue';font-size:32px;margin:0}
    .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .muted{color:rgba(0,0,0,0.6)}

    .card{background:#fff;padding:14px;border-radius:var(--radius);box-shadow:var(--shadow);}

    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid rgba(0,0,0,0.06);text-align:left}
    th{font-weight:700;background:rgba(0,0,0,0.02)}

    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--cyan);font-weight:700;color:var(--black)}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.08)}
    .btn-danger{background:#ff4d4d;color:#fff}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:60}
    .modal-card{background:#fff;padding:20px;border-radius:12px;min-width:320px;max-width:760px}
    label{margin-top:8px;display:block;font-size:14px}
    input,textarea,select{width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid rgba(0,0,0,0.15)}
    textarea{height:100px;resize:vertical}
    .modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}

    /* small */
    @media(max-width:900px){
      .search{min-width:140px}
      .page-header{flex-direction:column;align-items:flex-start;gap:12px}
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
  <div class="header-left">
    <div class="logo">
      <img src="Image/logoGrafikaCareerCenter-putih.png" 
           alt="Logo Grafika Career Center" 
           style="height:40px;">
    </div>
      <div class="search">
        üîç <input id="globalSearch" placeholder="Cari lowongan berdasarkan posisi atau perusahaan..."/>
      </div>
    </div>

    <div class="header-right">
      <button id="notifBtn" class="icon-btn">üîî<span id="notifBadge" class="badge" style="display:none">0</span></button>
      <button id="profileBtn" class="icon-btn">üë§</button>

      <div class="menu">
        <button id="dotsBtn" class="icon-btn">‚ãØ</button>
        <div id="menuBox" class="menu-box">
          <button onclick="location.href='dashboard-guru.html'">Dashboard</button>
        <button onclick="location.href='manajemen-siswa.html'">Manajemen Siswa</button>
        <button onclick="location.href='perusahaan-mitra.html'">Perusahaan Mitra</button>
        <button onclick="location.href='guru-lowonganpkl.html'">Lowongan Magang</button>
        <button onclick="location.href='pendaftaran-guru.html'">Pendaftaran Magang</button>
        <button onclick="location.href='monitoring-guru.html'">Monitoring</button>
        <button onclick="location.href='rekap-guru.html'">Rekap Monitoring</button>
        <button onclick="location.href='dokumen-guru.html'">Dokumen</button>
        <hr>
        <button onclick="location.href='profile-guru.html'">Profile</button>
        <button onclick="location.href='login.html'">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="container">
    <div class="page-header">
      <div>
        <h1>Lowongan Magang</h1>
        <div class="muted">Kelola lowongan magang dari perusahaan mitra</div>
      </div>

      <div>
        <button id="addBtn" class="btn btn-primary">+ Tambah Lowongan</button>
        <button id="exportBtn" class="btn btn-ghost">Export CSV</button>
      </div>
    </div>

    <div class="card">
      <table id="lowonganTable">
        <thead>
          <tr>
            <th>No</th>
            <th>Posisi</th>
            <th>Perusahaan</th>
            <th>Kriteria</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div style="margin-top:12px;color:rgba(0,0,0,0.6);font-size:14px">
        Referensi wireframe: <a href="/mnt/data/IS301-FINAL PROJECT-KELOMPOK 4 (4).docx" target="_blank">/mnt/data/IS301-FINAL PROJECT-KELOMPOK 4 (4).docx</a>
      </div>
    </div>
  </main>

  <!-- MODAL -->
  <div id="modal" class="modal">
    <div class="modal-card">
      <h2 id="modalTitle" style="font-family:'Bebas Neue';margin:0 0 10px 0">Tambah Lowongan</h2>

      <label>Posisi
        <input type="text" id="f_posisi" placeholder="Contoh: Frontend Developer">
      </label>

      <label>Perusahaan (pilih)
        <select id="f_perusahaan"></select>
      </label>

      <label>Kriteria (singkat)
        <input type="text" id="f_kriteria" placeholder="Contoh: Min. kelas XI">
      </label>

      <label>Status
        <select id="f_status">
          <option value="Buka">Buka</option>
          <option value="Tutup">Tutup</option>
        </select>
      </label>

      <label>Deskripsi
        <textarea id="f_deskripsi" placeholder="Deskripsi singkat lowongan..."></textarea>
      </label>

      <div class="modal-actions">
        <button class="btn btn-ghost" id="cancelBtn">Batal</button>
        <button class="btn btn-primary" id="saveBtn">Simpan</button>
      </div>
    </div>
  </div>

  <script>
    // Shared storage key (same as other guru pages)
    const STORAGE = "grafika_guru_data_v1";

    function seed(){
      if(!localStorage.getItem(STORAGE)){
        localStorage.setItem(STORAGE, JSON.stringify({
          siswa:[
            {id:1,nama:'Andi Putra',nis:'12001',kelas:'XII RPL 1',perusahaan:'PT Maju Jaya',status:'Magang'}
          ],
          mitra:[
            {id:1,nama:'PT Maju Jaya',bidang:'Teknologi',alamat:'Jakarta',email:'hrd@maju.co'},
            {id:2,nama:'CV Kreatif',bidang:'Desain',alamat:'Tangerang',email:'info@kreatif.com'}
          ],
          lowongan:[
            {id:1,posisi:'Frontend Developer',perusahaan:'PT Maju Jaya',kriteria:'Min. kelas XI',status:'Buka',deskripsi:'Frontend internship - HTML/CSS/JS'},
            {id:2,posisi:'Teknisi',perusahaan:'CV Kreatif',kriteria:'Teknik Otomotif',status:'Tutup',deskripsi:'Maintenance technician'}
          ],
          pendaftaran:[],
          monitoring:[],
          notif:[]
        }));
      }
    }
    seed();

    // DOM refs
    const tbody = document.querySelector("#lowonganTable tbody");
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const f_posisi = document.getElementById("f_posisi");
    const f_perusahaan = document.getElementById("f_perusahaan");
    const f_kriteria = document.getElementById("f_kriteria");
    const f_status = document.getElementById("f_status");
    const f_deskripsi = document.getElementById("f_deskripsi");
    const addBtn = document.getElementById("addBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const saveBtn = document.getElementById("saveBtn");
    const exportBtn = document.getElementById("exportBtn");
    const searchInput = document.getElementById("globalSearch");
    const dotsBtn = document.getElementById("dotsBtn");
    const menuBox = document.getElementById("menuBox");

    let editId = null;

    function load(){ return JSON.parse(localStorage.getItem(STORAGE) || "{}"); }
    function save(d){ localStorage.setItem(STORAGE, JSON.stringify(d)); }

    function populatePerusahaanSelect(){
      const D = load();
      f_perusahaan.innerHTML = "";
      (D.mitra || []).forEach(m=>{
        const opt = document.createElement("option");
        opt.value = m.nama;
        opt.textContent = m.nama;
        f_perusahaan.appendChild(opt);
      });
      // if no mitra, add empty option
      if((D.mitra||[]).length===0){
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "(Belum ada perusahaan)";
        f_perusahaan.appendChild(opt);
      }
    }

    function render(q=""){
      const D = load();
      let rows = D.lowongan || [];
      if(q){
        const qq = q.toLowerCase();
        rows = rows.filter(r => (r.posisi||"").toLowerCase().includes(qq) || (r.perusahaan||"").toLowerCase().includes(qq));
      }

      tbody.innerHTML = "";
      rows.forEach((l,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${escapeHtml(l.posisi)}</td>
          <td>${escapeHtml(l.perusahaan)}</td>
          <td>${escapeHtml(l.kriteria||'')}</td>
          <td>${escapeHtml(l.status)}</td>
          <td>
            <button class="btn btn-ghost" data-edit="${l.id}">Edit</button>
            <button class="btn btn-ghost" data-view="${l.id}">Detail</button>
            <button class="btn btn-danger" data-del="${l.id}">Hapus</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // notif badge
      const D0 = load();
      const notifBadge = document.getElementById("notifBadge");
      notifBadge.style.display = (D0.notif && D0.notif.length) ? 'inline-block' : 'none';
      notifBadge.textContent = (D0.notif||[]).length;
    }

    function escapeHtml(s){ if(s==null) return ''; return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }

    // open modal for add/edit
    function openModal(edit=false, obj={}){
      modal.style.display = "flex";
      modal.setAttribute('aria-hidden','false');
      modalTitle.textContent = edit ? "Edit Lowongan" : "Tambah Lowongan";
      editId = edit ? obj.id : null;
      f_posisi.value = obj.posisi || "";
      populatePerusahaanSelect();
      f_perusahaan.value = obj.perusahaan || (f_perusahaan.options[0] ? f_perusahaan.options[0].value : "");
      f_kriteria.value = obj.kriteria || "";
      f_status.value = obj.status || "Buka";
      f_deskripsi.value = obj.deskripsi || "";
    }
    function closeModal(){
      modal.style.display = "none";
      modal.setAttribute('aria-hidden','true');
      editId = null;
    }

    addBtn.addEventListener('click', ()=>{ populatePerusahaanSelect(); openModal(false, {}); });
    cancelBtn.addEventListener('click', closeModal);

    saveBtn.addEventListener('click', ()=>{
      const posisi = f_posisi.value.trim();
      const perusahaan = f_perusahaan.value;
      const kriteria = f_kriteria.value.trim();
      const status = f_status.value;
      const deskripsi = f_deskripsi.value.trim();

      if(!posisi) { alert("Posisi wajib diisi"); return; }

      const D = load();
      D.lowongan = D.lowongan || [];

      if(editId){
        const item = D.lowongan.find(x=>x.id===editId);
        if(item){
          item.posisi = posisi;
          item.perusahaan = perusahaan;
          item.kriteria = kriteria;
          item.status = status;
          item.deskripsi = deskripsi;
        }
      } else {
        D.lowongan.push({id:Date.now(), posisi, perusahaan, kriteria, status, deskripsi});
      }

      save(D);
      render(searchInput.value.trim());
      closeModal();
    });

    // delegated table actions
    tbody.addEventListener('click', (e)=>{
      const edit = e.target.closest('[data-edit]');
      const view = e.target.closest('[data-view]');
      const del = e.target.closest('[data-del]');
      if(edit){
        const id = Number(edit.dataset.edit);
        const D = load();
        const item = (D.lowongan||[]).find(x=>x.id===id);
        if(item) openModal(true, item);
      } else if(view){
        const id = Number(view.dataset.view);
        const D = load();
        const item = (D.lowongan||[]).find(x=>x.id===id);
        if(item){
          const info = `Posisi: ${item.posisi}\nPerusahaan: ${item.perusahaan}\nKriteria: ${item.kriteria||'-'}\nStatus: ${item.status}\nDeskripsi:\n${item.deskripsi||'-'}`;
          alert(info);
        }
      } else if(del){
        const id = Number(del.dataset.del);
        if(confirm('Hapus lowongan ini?')){
          const D = load();
          D.lowongan = (D.lowongan||[]).filter(x=>x.id!==id);
          save(D);
          render(searchInput.value.trim());
        }
      }
    });

    // search
    searchInput.addEventListener('input', (e)=> render(e.target.value.trim()));

    // export CSV
    exportBtn.addEventListener('click', ()=>{
      const D = load();
      const rows = [['Posisi','Perusahaan','Kriteria','Status','Deskripsi'], ...(D.lowongan||[]).map(l=>[l.posisi,l.perusahaan,l.kriteria,l.status,l.deskripsi])];
      const csv = rows.map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'lowongan_export.csv'; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },1500);
    });

    // menu titik 3 behavior
    dotsBtn.addEventListener('click', (e)=>{
      menuBox.style.display = menuBox.style.display === 'block' ? 'none' : 'block';
      e.stopPropagation();
    });
    menuBox.addEventListener('click', (e)=>{
      const b = e.target.closest('button[data-href]');
      if(b) location.href = b.dataset.href;
    });
    document.addEventListener('click', (e)=>{
      if(!e.target.closest('.menu')) menuBox.style.display = 'none';
    });

    // notif & profile
    document.getElementById('notifBtn').addEventListener('click', ()=>{
      const D = load();
      alert((D.notif||[]).map(n=>`${n.text} ‚Ä¢ ${n.time}`).join('\n') || 'Tidak ada notifikasi');
    });
    document.getElementById('profileBtn').addEventListener('click', ()=> location.href = 'profile-guru.html');

    // logout
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      if(confirm('Yakin ingin logout?')) { alert('Logout (placeholder)'); location.href='dashboard-guru.html'; }
    });

    // init
    populatePerusahaanSelect();
    render();
  </script>
</body>
</html>
